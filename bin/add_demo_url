#! /usr/bin/env python3
"""A script to add a demo URL to a possibly existing file compatible with ping_reviewers."""

import argparse
import json
from json import decoder
import logging
from typing import Optional, Sequence


def add_to_file(*, file: str, name: str, url: str) -> None:
    with open(file, 'a+') as json_file:
        json_file.seek(0)
        try:
            existing: dict[str, str] = json.load(json_file)
        except decoder.JSONDecodeError as error:
            logging.error(error)
            existing = {}
        json_file.seek(0)
        json_file.truncate()
        json.dump(existing | {name: url}, json_file, indent=2)


def main(string_args: Optional[Sequence[str]] = None) -> None:
    """Parse input arguments, and update the file accordingly."""

    parser = argparse.ArgumentParser(description='Add a demo URL for reviews.')
    parser.add_argument(
        '--file', '-f', default='/tmp/demo_urls.json',
        help='The name of the file to create/update.')
    parser.add_argument('name', help='The name of the demo to add')
    parser.add_argument('url', help='The URL of the demo to add')
    args = parser.parse_args(string_args)
    add_to_file(file=args.file, name=args.name, url=args.url)


if __name__ == '__main__':
    main()
